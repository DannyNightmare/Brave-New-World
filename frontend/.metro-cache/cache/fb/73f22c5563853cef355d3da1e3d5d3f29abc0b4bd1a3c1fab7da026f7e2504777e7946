{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/contexts/UserContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.UserProvider = UserProvider;\n  exports.useUser = useUser;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactJsxDevRuntime = require(_dependencyMap[1], \"react/jsx-dev-runtime\");\n  const API_URL = 'https://demerit-system-1.preview.emergentagent.com';\n  const UserContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function UserProvider({\n    children\n  }) {\n    _s();\n    const [user, setUser] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    const [failureData, setFailureData] = (0, _react.useState)(null);\n    const [showFailureModal, setShowFailureModal] = (0, _react.useState)(false);\n    const [hasCheckedFailures, setHasCheckedFailures] = (0, _react.useState)(false);\n    const createUser = async username => {\n      try {\n        const response = await fetch(`${API_URL}/api/users`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            username\n          })\n        });\n        const data = await response.json();\n        setUser(data);\n      } catch (error) {\n        console.error('Failed to create user:', error);\n      }\n    };\n    const refreshUser = async () => {\n      if (!user?.id) return;\n      try {\n        const response = await fetch(`${API_URL}/api/users/${user.id}`);\n        const data = await response.json();\n        setUser(data);\n      } catch (error) {\n        console.error('Failed to refresh user:', error);\n      }\n    };\n\n    // Check for quest failures and apply demerits\n    const checkQuestFailures = async () => {\n      if (!user?.id) return;\n      try {\n        const response = await fetch(`${API_URL}/api/quests/${user.id}/check-failures`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        const data = await response.json();\n        if (data.failed_quests && data.failed_quests.length > 0) {\n          setFailureData({\n            failedQuests: data.failed_quests,\n            totalDemerits: data.total_demerits\n          });\n          setShowFailureModal(true);\n          // Refresh user data after demerits have been applied\n          await refreshUser();\n        }\n      } catch (error) {\n        console.error('Failed to check quest failures:', error);\n      }\n    };\n    const dismissFailureModal = () => {\n      setShowFailureModal(false);\n      setFailureData(null);\n    };\n    (0, _react.useEffect)(() => {\n      // Auto-create a demo user for MVP\n      const initUser = async () => {\n        try {\n          const response = await fetch(`${API_URL}/api/users`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              username: 'Hero'\n            })\n          });\n          const data = await response.json();\n          setUser(data);\n        } catch (error) {\n          console.error('Failed to init user:', error);\n        } finally {\n          setLoading(false);\n        }\n      };\n      initUser();\n    }, []);\n\n    // Check for quest failures once user is loaded (only once per session)\n    (0, _react.useEffect)(() => {\n      if (user?.id && !hasCheckedFailures) {\n        setHasCheckedFailures(true);\n        // Delay the check slightly to allow the app to fully load\n        const timer = setTimeout(() => {\n          checkQuestFailures();\n        }, 1000);\n        return () => clearTimeout(timer);\n      }\n    }, [user?.id, hasCheckedFailures]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(UserContext.Provider, {\n      value: {\n        user,\n        loading,\n        refreshUser,\n        createUser,\n        failureData,\n        showFailureModal,\n        dismissFailureModal,\n        checkQuestFailures\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 5\n    }, this);\n  }\n  _s(UserProvider, \"WLfbzQ7HDjcFDaZ24Yb2bY41ZWg=\");\n  _c = UserProvider;\n  function useUser() {\n    _s2();\n    const context = (0, _react.useContext)(UserContext);\n    if (context === undefined) {\n      throw new Error('useUser must be used within a UserProvider');\n    }\n    return context;\n  }\n  _s2(useUser, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"UserProvider\");\n});","lineCount":147,"map":[[10,2,51,0,"exports"],[10,9,51,0],[10,10,51,0,"UserProvider"],[10,22,51,0],[10,25,51,0,"UserProvider"],[10,37,51,0],[11,2,160,0,"exports"],[11,9,160,0],[11,10,160,0,"useUser"],[11,17,160,0],[11,20,160,0,"useUser"],[11,27,160,0],[12,2,1,0],[12,6,1,0,"_react"],[12,12,1,0],[12,15,1,0,"require"],[12,22,1,0],[12,23,1,0,"_dependencyMap"],[12,37,1,0],[13,2,1,89],[13,6,1,89,"_reactJsxDevRuntime"],[13,25,1,89],[13,28,1,89,"require"],[13,35,1,89],[13,36,1,89,"_dependencyMap"],[13,50,1,89],[14,2,3,0],[14,8,3,6,"API_URL"],[14,15,3,13],[14,18,3,16],[14,70,3,68],[15,2,49,0],[15,8,49,6,"UserContext"],[15,19,49,17],[15,35,49,20],[15,39,49,20,"createContext"],[15,45,49,33],[15,46,49,33,"createContext"],[15,59,49,33],[15,61,49,63,"undefined"],[15,70,49,72],[15,71,49,73],[16,2,51,7],[16,11,51,16,"UserProvider"],[16,23,51,28,"UserProvider"],[16,24,51,29],[17,4,51,31,"children"],[18,2,51,65],[18,3,51,66],[18,5,51,68],[19,4,51,68,"_s"],[19,6,51,68],[20,4,52,2],[20,10,52,8],[20,11,52,9,"user"],[20,15,52,13],[20,17,52,15,"setUser"],[20,24,52,22],[20,25,52,23],[20,28,52,26],[20,32,52,26,"useState"],[20,38,52,34],[20,39,52,34,"useState"],[20,47,52,34],[20,49,52,48],[20,53,52,52],[20,54,52,53],[21,4,53,2],[21,10,53,8],[21,11,53,9,"loading"],[21,18,53,16],[21,20,53,18,"setLoading"],[21,30,53,28],[21,31,53,29],[21,34,53,32],[21,38,53,32,"useState"],[21,44,53,40],[21,45,53,40,"useState"],[21,53,53,40],[21,55,53,41],[21,59,53,45],[21,60,53,46],[22,4,54,2],[22,10,54,8],[22,11,54,9,"failureData"],[22,22,54,20],[22,24,54,22,"setFailureData"],[22,38,54,36],[22,39,54,37],[22,42,54,40],[22,46,54,40,"useState"],[22,52,54,48],[22,53,54,48,"useState"],[22,61,54,48],[22,63,54,69],[22,67,54,73],[22,68,54,74],[23,4,55,2],[23,10,55,8],[23,11,55,9,"showFailureModal"],[23,27,55,25],[23,29,55,27,"setShowFailureModal"],[23,48,55,46],[23,49,55,47],[23,52,55,50],[23,56,55,50,"useState"],[23,62,55,58],[23,63,55,58,"useState"],[23,71,55,58],[23,73,55,59],[23,78,55,64],[23,79,55,65],[24,4,56,2],[24,10,56,8],[24,11,56,9,"hasCheckedFailures"],[24,29,56,27],[24,31,56,29,"setHasCheckedFailures"],[24,52,56,50],[24,53,56,51],[24,56,56,54],[24,60,56,54,"useState"],[24,66,56,62],[24,67,56,62,"useState"],[24,75,56,62],[24,77,56,63],[24,82,56,68],[24,83,56,69],[25,4,58,2],[25,10,58,8,"createUser"],[25,20,58,18],[25,23,58,21],[25,29,58,28,"username"],[25,37,58,44],[25,41,58,49],[26,6,59,4],[26,10,59,8],[27,8,60,6],[27,14,60,12,"response"],[27,22,60,20],[27,25,60,23],[27,31,60,29,"fetch"],[27,36,60,34],[27,37,60,35],[27,40,60,38,"API_URL"],[27,47,60,45],[27,59,60,57],[27,61,60,59],[28,10,61,8,"method"],[28,16,61,14],[28,18,61,16],[28,24,61,22],[29,10,62,8,"headers"],[29,17,62,15],[29,19,62,17],[30,12,62,19],[30,26,62,33],[30,28,62,35],[31,10,62,54],[31,11,62,55],[32,10,63,8,"body"],[32,14,63,12],[32,16,63,14,"JSON"],[32,20,63,18],[32,21,63,19,"stringify"],[32,30,63,28],[32,31,63,29],[33,12,63,31,"username"],[34,10,63,40],[34,11,63,41],[35,8,64,6],[35,9,64,7],[35,10,64,8],[36,8,65,6],[36,14,65,12,"data"],[36,18,65,16],[36,21,65,19],[36,27,65,25,"response"],[36,35,65,33],[36,36,65,34,"json"],[36,40,65,38],[36,41,65,39],[36,42,65,40],[37,8,66,6,"setUser"],[37,15,66,13],[37,16,66,14,"data"],[37,20,66,18],[37,21,66,19],[38,6,67,4],[38,7,67,5],[38,8,67,6],[38,15,67,13,"error"],[38,20,67,18],[38,22,67,20],[39,8,68,6,"console"],[39,15,68,13],[39,16,68,14,"error"],[39,21,68,19],[39,22,68,20],[39,46,68,44],[39,48,68,46,"error"],[39,53,68,51],[39,54,68,52],[40,6,69,4],[41,4,70,2],[41,5,70,3],[42,4,72,2],[42,10,72,8,"refreshUser"],[42,21,72,19],[42,24,72,22],[42,30,72,22,"refreshUser"],[42,31,72,22],[42,36,72,34],[43,6,73,4],[43,10,73,8],[43,11,73,9,"user"],[43,15,73,13],[43,17,73,15,"id"],[43,19,73,17],[43,21,73,19],[44,6,74,4],[44,10,74,8],[45,8,75,6],[45,14,75,12,"response"],[45,22,75,20],[45,25,75,23],[45,31,75,29,"fetch"],[45,36,75,34],[45,37,75,35],[45,40,75,38,"API_URL"],[45,47,75,45],[45,61,75,59,"user"],[45,65,75,63],[45,66,75,64,"id"],[45,68,75,66],[45,70,75,68],[45,71,75,69],[46,8,76,6],[46,14,76,12,"data"],[46,18,76,16],[46,21,76,19],[46,27,76,25,"response"],[46,35,76,33],[46,36,76,34,"json"],[46,40,76,38],[46,41,76,39],[46,42,76,40],[47,8,77,6,"setUser"],[47,15,77,13],[47,16,77,14,"data"],[47,20,77,18],[47,21,77,19],[48,6,78,4],[48,7,78,5],[48,8,78,6],[48,15,78,13,"error"],[48,20,78,18],[48,22,78,20],[49,8,79,6,"console"],[49,15,79,13],[49,16,79,14,"error"],[49,21,79,19],[49,22,79,20],[49,47,79,45],[49,49,79,47,"error"],[49,54,79,52],[49,55,79,53],[50,6,80,4],[51,4,81,2],[51,5,81,3],[53,4,83,2],[54,4,84,2],[54,10,84,8,"checkQuestFailures"],[54,28,84,26],[54,31,84,29],[54,37,84,29,"checkQuestFailures"],[54,38,84,29],[54,43,84,41],[55,6,85,4],[55,10,85,8],[55,11,85,9,"user"],[55,15,85,13],[55,17,85,15,"id"],[55,19,85,17],[55,21,85,19],[56,6,86,4],[56,10,86,8],[57,8,87,6],[57,14,87,12,"response"],[57,22,87,20],[57,25,87,23],[57,31,87,29,"fetch"],[57,36,87,34],[57,37,87,35],[57,40,87,38,"API_URL"],[57,47,87,45],[57,62,87,60,"user"],[57,66,87,64],[57,67,87,65,"id"],[57,69,87,67],[57,86,87,84],[57,88,87,86],[58,10,88,8,"method"],[58,16,88,14],[58,18,88,16],[58,24,88,22],[59,10,89,8,"headers"],[59,17,89,15],[59,19,89,17],[60,12,89,19],[60,26,89,33],[60,28,89,35],[61,10,89,54],[62,8,90,6],[62,9,90,7],[62,10,90,8],[63,8,91,6],[63,14,91,12,"data"],[63,18,91,16],[63,21,91,19],[63,27,91,25,"response"],[63,35,91,33],[63,36,91,34,"json"],[63,40,91,38],[63,41,91,39],[63,42,91,40],[64,8,93,6],[64,12,93,10,"data"],[64,16,93,14],[64,17,93,15,"failed_quests"],[64,30,93,28],[64,34,93,32,"data"],[64,38,93,36],[64,39,93,37,"failed_quests"],[64,52,93,50],[64,53,93,51,"length"],[64,59,93,57],[64,62,93,60],[64,63,93,61],[64,65,93,63],[65,10,94,8,"setFailureData"],[65,24,94,22],[65,25,94,23],[66,12,95,10,"failedQuests"],[66,24,95,22],[66,26,95,24,"data"],[66,30,95,28],[66,31,95,29,"failed_quests"],[66,44,95,42],[67,12,96,10,"totalDemerits"],[67,25,96,23],[67,27,96,25,"data"],[67,31,96,29],[67,32,96,30,"total_demerits"],[68,10,97,8],[68,11,97,9],[68,12,97,10],[69,10,98,8,"setShowFailureModal"],[69,29,98,27],[69,30,98,28],[69,34,98,32],[69,35,98,33],[70,10,99,8],[71,10,100,8],[71,16,100,14,"refreshUser"],[71,27,100,25],[71,28,100,26],[71,29,100,27],[72,8,101,6],[73,6,102,4],[73,7,102,5],[73,8,102,6],[73,15,102,13,"error"],[73,20,102,18],[73,22,102,20],[74,8,103,6,"console"],[74,15,103,13],[74,16,103,14,"error"],[74,21,103,19],[74,22,103,20],[74,55,103,53],[74,57,103,55,"error"],[74,62,103,60],[74,63,103,61],[75,6,104,4],[76,4,105,2],[76,5,105,3],[77,4,107,2],[77,10,107,8,"dismissFailureModal"],[77,29,107,27],[77,32,107,30,"dismissFailureModal"],[77,33,107,30],[77,38,107,36],[78,6,108,4,"setShowFailureModal"],[78,25,108,23],[78,26,108,24],[78,31,108,29],[78,32,108,30],[79,6,109,4,"setFailureData"],[79,20,109,18],[79,21,109,19],[79,25,109,23],[79,26,109,24],[80,4,110,2],[80,5,110,3],[81,4,112,2],[81,8,112,2,"useEffect"],[81,14,112,11],[81,15,112,11,"useEffect"],[81,24,112,11],[81,26,112,12],[81,32,112,18],[82,6,113,4],[83,6,114,4],[83,12,114,10,"initUser"],[83,20,114,18],[83,23,114,21],[83,29,114,21,"initUser"],[83,30,114,21],[83,35,114,33],[84,8,115,6],[84,12,115,10],[85,10,116,8],[85,16,116,14,"response"],[85,24,116,22],[85,27,116,25],[85,33,116,31,"fetch"],[85,38,116,36],[85,39,116,37],[85,42,116,40,"API_URL"],[85,49,116,47],[85,61,116,59],[85,63,116,61],[86,12,117,10,"method"],[86,18,117,16],[86,20,117,18],[86,26,117,24],[87,12,118,10,"headers"],[87,19,118,17],[87,21,118,19],[88,14,118,21],[88,28,118,35],[88,30,118,37],[89,12,118,56],[89,13,118,57],[90,12,119,10,"body"],[90,16,119,14],[90,18,119,16,"JSON"],[90,22,119,20],[90,23,119,21,"stringify"],[90,32,119,30],[90,33,119,31],[91,14,119,33,"username"],[91,22,119,41],[91,24,119,43],[92,12,119,50],[92,13,119,51],[93,10,120,8],[93,11,120,9],[93,12,120,10],[94,10,121,8],[94,16,121,14,"data"],[94,20,121,18],[94,23,121,21],[94,29,121,27,"response"],[94,37,121,35],[94,38,121,36,"json"],[94,42,121,40],[94,43,121,41],[94,44,121,42],[95,10,122,8,"setUser"],[95,17,122,15],[95,18,122,16,"data"],[95,22,122,20],[95,23,122,21],[96,8,123,6],[96,9,123,7],[96,10,123,8],[96,17,123,15,"error"],[96,22,123,20],[96,24,123,22],[97,10,124,8,"console"],[97,17,124,15],[97,18,124,16,"error"],[97,23,124,21],[97,24,124,22],[97,46,124,44],[97,48,124,46,"error"],[97,53,124,51],[97,54,124,52],[98,8,125,6],[98,9,125,7],[98,18,125,16],[99,10,126,8,"setLoading"],[99,20,126,18],[99,21,126,19],[99,26,126,24],[99,27,126,25],[100,8,127,6],[101,6,128,4],[101,7,128,5],[102,6,129,4,"initUser"],[102,14,129,12],[102,15,129,13],[102,16,129,14],[103,4,130,2],[103,5,130,3],[103,7,130,5],[103,9,130,7],[103,10,130,8],[105,4,132,2],[106,4,133,2],[106,8,133,2,"useEffect"],[106,14,133,11],[106,15,133,11,"useEffect"],[106,24,133,11],[106,26,133,12],[106,32,133,18],[107,6,134,4],[107,10,134,8,"user"],[107,14,134,12],[107,16,134,14,"id"],[107,18,134,16],[107,22,134,20],[107,23,134,21,"hasCheckedFailures"],[107,41,134,39],[107,43,134,41],[108,8,135,6,"setHasCheckedFailures"],[108,29,135,27],[108,30,135,28],[108,34,135,32],[108,35,135,33],[109,8,136,6],[110,8,137,6],[110,14,137,12,"timer"],[110,19,137,17],[110,22,137,20,"setTimeout"],[110,32,137,30],[110,33,137,31],[110,39,137,37],[111,10,138,8,"checkQuestFailures"],[111,28,138,26],[111,29,138,27],[111,30,138,28],[112,8,139,6],[112,9,139,7],[112,11,139,9],[112,15,139,13],[112,16,139,14],[113,8,140,6],[113,15,140,13],[113,21,140,19,"clearTimeout"],[113,33,140,31],[113,34,140,32,"timer"],[113,39,140,37],[113,40,140,38],[114,6,141,4],[115,4,142,2],[115,5,142,3],[115,7,142,5],[115,8,142,6,"user"],[115,12,142,10],[115,14,142,12,"id"],[115,16,142,14],[115,18,142,16,"hasCheckedFailures"],[115,36,142,34],[115,37,142,35],[115,38,142,36],[116,4,144,2],[116,24,145,4],[116,28,145,4,"_reactJsxDevRuntime"],[116,47,145,4],[116,48,145,4,"jsxDEV"],[116,54,145,4],[116,56,145,5,"UserContext"],[116,67,145,16],[116,68,145,17,"Provider"],[116,76,145,25],[117,6,145,26,"value"],[117,11,145,31],[117,13,145,33],[118,8,146,6,"user"],[118,12,146,10],[119,8,147,6,"loading"],[119,15,147,13],[120,8,148,6,"refreshUser"],[120,19,148,17],[121,8,149,6,"createUser"],[121,18,149,16],[122,8,150,6,"failureData"],[122,19,150,17],[123,8,151,6,"showFailureModal"],[123,24,151,22],[124,8,152,6,"dismissFailureModal"],[124,27,152,25],[125,8,153,6,"checkQuestFailures"],[126,6,154,4],[126,7,154,6],[127,6,154,6,"children"],[127,14,154,6],[127,16,155,7,"children"],[128,4,155,15],[129,6,155,15,"fileName"],[129,14,155,15],[129,16,155,15,"_jsxFileName"],[129,28,155,15],[130,6,155,15,"lineNumber"],[130,16,155,15],[131,6,155,15,"columnNumber"],[131,18,155,15],[132,4,155,15],[132,11,156,26],[132,12,156,27],[133,2,158,0],[134,2,158,1,"_s"],[134,4,158,1],[134,5,51,16,"UserProvider"],[134,17,51,28],[135,2,51,28,"_c"],[135,4,51,28],[135,7,51,16,"UserProvider"],[135,19,51,28],[136,2,160,7],[136,11,160,16,"useUser"],[136,18,160,23,"useUser"],[136,19,160,23],[136,21,160,26],[137,4,160,26,"_s2"],[137,7,160,26],[138,4,161,2],[138,10,161,8,"context"],[138,17,161,15],[138,20,161,18],[138,24,161,18,"useContext"],[138,30,161,28],[138,31,161,28,"useContext"],[138,41,161,28],[138,43,161,29,"UserContext"],[138,54,161,40],[138,55,161,41],[139,4,162,2],[139,8,162,6,"context"],[139,15,162,13],[139,20,162,18,"undefined"],[139,29,162,27],[139,31,162,29],[140,6,163,4],[140,12,163,10],[140,16,163,14,"Error"],[140,21,163,19],[140,22,163,20],[140,66,163,64],[140,67,163,65],[141,4,164,2],[142,4,165,2],[142,11,165,9,"context"],[142,18,165,16],[143,2,166,0],[144,2,166,1,"_s2"],[144,5,166,1],[144,6,160,16,"useUser"],[144,13,160,23],[145,2,160,23],[145,6,160,23,"_c"],[145,8,160,23],[146,2,160,23,"$RefreshReg$"],[146,14,160,23],[146,15,160,23,"_c"],[146,17,160,23],[147,0,160,23],[147,3]],"functionMap":{"names":["<global>","UserProvider","createUser","refreshUser","checkQuestFailures","dismissFailureModal","useEffect$argument_0","initUser","setTimeout$argument_0","<anonymous>","useUser"],"mappings":"AAA;OCkD;qBCO;GDY;sBEE;GFS;6BGG;GHqB;8BIE;GJG;YKE;qBCE;KDc;GLE;YKG;+BEI;OFE;aGC,yBH;GLE;CDgB;OUE;CVM"},"hasCjsExports":false},"type":"js/module"}]}